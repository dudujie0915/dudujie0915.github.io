---
title: 【笔记】核心语法之变量
date: 2017-07-28
tags: [笔记,教程,JavaScript]
categories: JavaScript
---
# 变量声明
在JavaScript程序中，使用一个变量之前应当先声明；变量是使用关键字var来声明的：
```javascript
var i;
var sum;
//可以通过一个var关键字来声明多个变量：
var i,sum;
// 还可以将变量的初始赋值和变量声明合写在一起：
var s = "hello";
var i=0,j=0,k=0;
```
如果未在var声明语句中给变量指定初始值，那么虽然声明了这个变量，但在给它存入一个值之前，它的初始值就是underfined；     
在for和for/in循环中同样可以使用var语句；     
JavaScript变量可以是任意数据类型；

## 重复的声明和遗漏的声明
使用var语句重复声明变量是合法且无害的；如果重复声明带有初始化器，那么这就和一条简单地赋值语句没什么两样；     
在ES5严格模式中，给一个没有声明的变量赋值也会报错；从历史上来看，不赋值也可以使用，但是这个不好的习惯会造成很多bug，因此应当始终使用var来声明变量；

# 变量作用域
一个变量的作用域是程序源代码中定义这个变量的区域；全局变量拥有全局作用域，在JavaScript代码中的任何地方都是有定义的；在函数内声明的变量只在函数体内有定义，它们是局部变量，作用域是局部性的；函数参数也是局部变量，它们只在函数体内有定义；     
在函数体内，局部变量的优先级高于同名的全局变量；如果在函数内声明一个局部变量或者函数参数中带有的变量和全局变量重名，那么全局变量就会被局部变量所遮盖；     
尽管在全局作用域编写代码时可以不写var语句，但声明局部变量时则必须使用var语句；     
函数定义是可以嵌套的，由于每个函数都有它自己的作用域，因此会出现几个局部作用域嵌套的情况；     
## 函数作用域和声明提前
JavaScript使用了函数作用域：变量在声明它们的函数体以及这个函数体嵌套的任意函数体内都是有定义的；     
JavaScript的函数作用域是指在函数内声明的所有变量在函数体内始终是可见的，这意味着变量在声明之前甚至已经使用，JavaScript的这个特性被非正式地称为声明提前，即JavaScript函数里声明的所有变量(但不涉及赋值)都被“提前”至函数体的顶部；
```javascript
var scope = "global";
function f(){
    console.log(scope);  //输出"underfined"
    var scope = "local";
    console.log(scope);  //输出"local"
}
//上面代码等同于：
var scope = "global";
function f(){
    var scope;
    console.log(scope);
    scope = "local";
    console.log(scope);
}
```

## 作为属性的变量
当声明一个JavaScript全局变量时，实际上是定义了全局对象的一个属性，这是在ES规范中强制规定的；当使用var声明一个变量时，创建的这个属性是不可配置的，也就是说这个变量无法通过delete运算符删除；未使用严格模式并给一个未声明的变量赋值的话，JavaScript会自动创建一个全局变量，以这种方式创建的变量是全局对象的正常的可配置属性，并可以删除它们：
```javascript
var t = 1;
f = 2;
this.f2 = 3;
delete t  // => false:：变量并没有被删除
delete f  // => true：变量被删除
delete this.f2  // => true：变量被删除
```

## 作用域链
JavaScript是基于语法作用域的语言：通过阅读包含变量定义在内的数行源码就能知道变量的作用域；全局变量在程序中始终都是有定义的；局部变量在声明它的函数体内以及其所嵌套的函数内始终是有定义的；     
每一段JavaScript代码(全局代码或函数)都有一个与之关联的作用域链，这个作用域链是一个对象列表或者链表，这组对象定义了这段代码"作用域中"的变量；当JavaScript需要查找变量x的值的时候（这个过程称为“变量解析”），它会从链表的第一个对象开始查找，如果这个对象由一个名为x的属性，则会直接使用这个属性的值，如果第一个对象没有名为x的属性，JavaScript会继续查找链上的下一个对象；如果第二个对象依然没有名为x的属性，则会继续查找下一个对象，以此类推；如果作用域链上没有任何一个对象含有属性x，那么就认为这段代码的作用域链上不存在x，并最终抛出一个引用错误异常；     
在JavaScript的最顶层代码中(也就是不包含任何函数定义内的代码)，作用域链由一个全局变量组成；在不包含嵌套的函数体内，作用域链上有两个对象，第一个是定义函数参数和局部变量的对象，第二个是全局对象；在一个嵌套函数体内，作用域链上至少有三个对象；     
当定义一个函数时，它实际上保存一个作用域链；当调用这个函数时，它创建一个新的对象来存储它的局部变量，并将这个对象添加至保存的那个作用域链上，同事创建一个新的更长的表示函数调用作用域的“链”；     
对于嵌套函数来说，每次调用外部函数时，内部函数在每次定义的时候都有微妙的差别--在每次调用外部函数时，内部函数的代码都是相同的，而且关联这段代码的作用域链也不相同；